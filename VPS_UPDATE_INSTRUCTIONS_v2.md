# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é VPS —Å–µ—Ä–≤–µ—Ä–∞ MapMon v0.5

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-01-08  
**–í–µ—Ä—Å–∏—è**: v0.5 —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏  
**GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: https://github.com/iForza/Fmon.git

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —ç—Ç–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:
1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ frontend polling**
2. **–£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã**
3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**
4. **–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞—Ç–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

---

## üîÑ –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è VPS

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ backup —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS —Å–µ—Ä–≤–µ—Ä—É
ssh your-user@your-vps-ip

# –°–æ–∑–¥–∞–π—Ç–µ backup —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã
cd /path/to/your/mapmon/project
cp -r . ../mapmon-backup-$(date +%Y%m%d-%H%M)

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã PM2 (–µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç)
pm2 stop all
pm2 save
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ GitHub

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/your/mapmon/project

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
git stash

# –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git fetch origin
git pull origin master

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
git stash pop
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm ci

# –ò–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ package.json
npm install

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
npm ls
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env
nano .env

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
# - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
# - MQTT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –±—Ä–æ–∫–µ—Ä)
# - –ü–æ—Ä—Ç—ã –∏ URL
```

### –®–∞–≥ 5: –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ Nuxt –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è production
npm run build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
ls -la .output/
```

### –®–∞–≥ 6: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ PM2
pm2 start ecosystem.config.cjs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
pm2 status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API
curl http://localhost:3001/api/status

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
# {"status":"API Server running with SQLite"}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ frontend
curl http://localhost:3000

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ PM2:
```bash
pm2 status

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 3 –ø—Ä–æ—Ü–µ—Å—Å–∞:
# - mapmon (Nuxt frontend)
# - mapmon-api (Fastify API)
# - mqtt-collector (MQTT –¥–∞–Ω–Ω—ã–µ)
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è frontend:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs mapmon

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run build
pm2 restart mapmon
```

### –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç API:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API
pm2 logs mapmon-api

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQLite –±–∞–∑—É
ls -la server-backup/mapmon.db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API
pm2 restart mapmon-api
```

### –ï—Å–ª–∏ –Ω–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç MQTT –¥–∞–Ω–Ω—ã–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MQTT collector
pm2 logs mqtt-collector

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±—Ä–æ–∫–µ—Ä—É
# (–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å test.mosquitto.org –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ collector
pm2 restart mqtt-collector
```

---

## üîÑ –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PM2
pm2 stop all

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backup
cd /path/to/your/
rm -rf mapmon
mv mapmon-backup-[–¥–∞—Ç–∞] mapmon
cd mapmon

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
pm2 start ecosystem.config.cjs
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h
pm2 monit

# –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
# –ü–∞–º—è—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç–∏
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ real-time
pm2 logs --lines 50

# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
# "üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤" –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ESP32 –¥–∞–Ω–Ω—ã–µ:
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç
curl http://localhost:3001/api/telemetry/latest

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# –û—Ç–∫—Ä–æ–π—Ç–µ http://your-vps-ip:3000
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2 (ecosystem.config.cjs)

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```javascript
module.exports = {
  apps: [
    {
      name: 'mapmon',
      script: '.output/server/index.mjs',
      port: 3000,
      env: {
        NODE_ENV: 'production'
      }
    },
    {
      name: 'mapmon-api',
      script: 'server-backup/api-server.cjs',
      port: 3001
    },
    {
      name: 'mqtt-collector',
      script: 'server-backup/mqtt-collector.cjs'
    }
  ]
}
```

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã):
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ
pm2 delete all

# –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
rm -rf node_modules
rm -rf .nuxt
rm -rf .output

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
npm install
npm run build
pm2 start ecosystem.config.cjs
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PM2:
```bash
# –û–±–Ω–æ–≤–∏—Ç–µ PM2 –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
npm install -g pm2@latest
pm2 update
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: `pm2 logs`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å**: `pm2 status`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã**: `netstat -tulpn | grep :300`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å**: `free -h`

### –§–∞–π–ª—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- **–õ–æ–≥–∏ PM2**: `~/.pm2/logs/`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `server-backup/mapmon.db`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `ecosystem.config.cjs`

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] PM2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ —Å—Ç–∞—Ç—É—Å–µ "online"
- [ ] API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ http://localhost:3001/api/status
- [ ] Frontend –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ http://localhost:3000
- [ ] MQTT –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ)
- [ ] –ü–∞–º—è—Ç—å –Ω–µ —Ä–∞—Å—Ç–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Ç–µ—á–∫–∏)
- [ ] ESP32 –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ
- [ ] –õ–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

**–ì–æ—Ç–æ–≤–æ!** üéâ VPS —Å–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏.