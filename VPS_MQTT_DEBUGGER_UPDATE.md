# üêõ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø MQTT –û–¢–õ–ê–î–ß–ò–ö–ê - –û–ë–ù–û–í–õ–ï–ù–ò–ï VPS**

## üìã **–°–¢–ê–¢–£–° –ü–†–û–ë–õ–ï–ú**
‚ùå **–û—à–∏–±–∫–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**: `Cannot read properties of undefined (reading 'size')`
‚ùå **MQTT –æ—à–∏–±–∫–∏**: `connack timeout` –≤ –ª–æ–≥–∞—Ö mqtt-collector
‚ùå **–û—à–∏–±–∫–∞ 500**: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /history –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ VPS
‚úÖ **–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

## üîß **–ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û**
1. **useApi.ts**: –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `vehicles.value?.size || 0`
2. **history.vue**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç MQTT.js –∏ –¥–æ–±–∞–≤–ª–µ–Ω –¥–µ–º–æ —Ä–µ–∂–∏–º
3. **MQTT –æ—Ç–ª–∞–¥—á–∏–∫**: —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback
4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

## üöÄ **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø VPS**

### **1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:**
```bash
ssh root@147.45.213.22
```

### **2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø–∞–º—è—Ç–∏:**
```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/mapmon

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 stop ecosystem.config.cjs

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–∑ GitHub
git pull origin master

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–≤–∫–ª—é—á–∞—è mqtt –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
yarn install --production

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
yarn build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
pm2 restart ecosystem.config.cjs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
pm2 logs
```

## üìä **–û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢**

### **–î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
‚ùå –û—à–∏–±–∫–∞ 500 –Ω–∞ /history
‚ùå `Cannot read properties of undefined (reading 'size')`
‚ùå MQTT –∫–æ–ª–ª–µ–∫—Ç–æ—Ä: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ `connack timeout`

### **–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ /history –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ MQTT –æ—Ç–ª–∞–¥—á–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å `.size` –≤ –ª–æ–≥–∞—Ö
‚úÖ Fallback –Ω–∞ —Å–∏–º—É–ª—è—Ü–∏—é –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MQTT

## üé≠ **–ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨**

**MQTT –æ—Ç–ª–∞–¥—á–∏–∫ —Å –¥–µ–º–æ —Ä–µ–∂–∏–º–æ–º:**
- üìç –°–∏–º—É–ª—è—Ü–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ ESP32_Car_2046
- üíì Heartbeat —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 3-5 —Å–µ–∫—É–Ω–¥  
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- üé® –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- üì§ –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –≤ JSON

## üîç **–ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ PM2 —Å—Ç–∞—Ç—É—Å–∞:**
```bash
pm2 status
# –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å online
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏:**
```bash
pm2 logs --lines 20
# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ 'size' –∏–ª–∏ 500
```

### **3. –¢–µ—Å—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://fleetmonitor.ru/history
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "MQTT –û—Ç–ª–∞–¥–∫–∞"  
3. –î–æ–ª–∂–µ–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–µ–º–æ —Ä–µ–∂–∏–º
4. –ü–æ—è–≤—è—Ç—Å—è —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ESP32

## üö® **–í–ê–ñ–ù–´–ï –ö–û–ú–ê–ù–î–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò**

```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
git log --oneline -5
git reset --hard <–ø—Ä–µ–¥—ã–¥—É—â–∏–π_–∫–æ–º–º–∏—Ç>
pm2 restart ecosystem.config.cjs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–¥–ª—è yarn build)
df -h

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏
top
```

## üéØ **–ö–†–ò–¢–ò–ß–ù–û–°–¢–¨ –û–ë–ù–û–í–õ–ï–ù–ò–Ø**

‚ö†Ô∏è **–í–´–°–û–ö–ê–Ø** - –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–∞–π—Ç –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫–∏ 500
‚ö†Ô∏è **–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –ó–ê–¢–†–û–ù–£–¢–´** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞  
‚ö†Ô∏è **MQTT –î–ê–ù–ù–´–ï** - –∫–æ–ª–ª–µ–∫—Ç–æ—Ä —Ç–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ!**

---
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 27.06.2025 16:31
**Git –∫–æ–º–º–∏—Ç:** 82e1152 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ MQTT –æ—Ç–ª–∞–¥—á–∏–∫–∞
**–°—Ç–∞—Ç—É—Å:** üîÑ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é 