# üîß –ü–õ–ê–ù –†–ï–®–ï–ù–ò–Ø: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å MQTT –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üö® –ü–†–û–ë–õ–ï–ú–ê
**ESP32 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TCP MQTT (–ø–æ—Ä—Ç 1883), –∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ WebSocket MQTT (–ø–æ—Ä—Ç 8081) - –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã**

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ESP32: `PubSubClient` ‚Üí `test.mosquitto.org:1883` (TCP MQTT)
- –í–µ–±: `MQTT.js` ‚Üí `test.mosquitto.org:8081` (WebSocket MQTT)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

## üéØ –¶–ï–õ–¨
–û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É ESP32 –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –¥–ª—è –æ–±–º–µ–Ω–∞ MQTT —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

## üîç –í–ê–†–ò–ê–ù–¢–´ –†–ï–®–ï–ù–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–µ—Ä–≤–µ—Ä–Ω—ã–π MQTT –º–æ—Å—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô)
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è ESP32 –∫–æ–¥–∞
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—Ö–æ–¥ ESP32 –Ω–∞ WebSocket MQTT
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- ‚úÖ –ú–µ–Ω—å—à–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ ESP32 –∫–æ–¥–∞
- ‚ùå –ú–µ–Ω–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚ùå –ë–æ–ª—å—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ ESP32

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (–í–∞—Ä–∏–∞–Ω—Ç 1 - –°–µ—Ä–≤–µ—Ä–Ω—ã–π –º–æ—Å—Ç)

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å server-backup/mqtt-collector.cjs
```javascript
// –î–æ–±–∞–≤–∏—Ç—å WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–µ–±
const WebSocket = require('ws');
const wss = new WebSocket.Server({ port: 3001 });

// –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ MQTT —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å –≤ WebSocket
client.on('message', (topic, message) => {
  const data = {
    topic,
    message: message.toString(),
    timestamp: new Date().toISOString()
  };
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º WebSocket –∫–ª–∏–µ–Ω—Ç–∞–º
  wss.clients.forEach(ws => {
    if (ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify(data));
    }
  });
});
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å pages/history.vue
```javascript
// –ó–∞–º–µ–Ω–∏—Ç—å MQTT.js –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ WebSocket
const ws = new WebSocket('ws://localhost:3001');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ MQTT —Å–æ–æ–±—â–µ–Ω–∏–µ
  mqttMessages.value.push({
    topic: data.topic,
    message: data.message,
    timestamp: data.timestamp
  });
};
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å mqtt-collector.cjs —Å WebSocket –º–æ—Å—Ç–æ–º
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ WebSocket
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ MQTT —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ESP32
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê
- ‚úÖ ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ TCP MQTT
- ‚úÖ –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ—Ö–æ–¥—è—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ VPS