# üö® –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 502 BAD GATEWAY

## ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê:**
```
HTTP/1.1 502 Bad Gateway
```
Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend —Å–µ—Ä–≤–µ—Ä–∞–º!

## üîç **–î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ï –ö–û–ú–ê–ù–î–´:**

### **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç –ª–∏ backend —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª—É—à–∞—é—Ç –ª–∏ –ø–æ—Ä—Ç—ã 3000 –∏ 3001
sudo netstat -tulpn | grep -E ":3000|:3001"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã
pm2 status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API
curl -v http://localhost:3001/api/status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ frontend
curl -v http://localhost:3000/
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫:**
```bash
# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∞–π—Ç–∞
sudo tail -f /var/log/nginx/mapmon.error.log

# –õ–æ–≥–∏ PM2
pm2 logs
```

### **3. –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/mapmon

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
pm2 stop all

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
pm2 start ecosystem.config.cjs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
pm2 logs --lines 20
```

### **4. –ï—Å–ª–∏ PM2 –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è - —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É
cd /var/www/mapmon

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ node_modules
ls -la node_modules/ | head -5

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä –≤—Ä—É—á–Ω—É—é
node server-backup/api-server.cjs

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
curl http://localhost:3001/api/status
```

### **5. –ï—Å–ª–∏ –Ω–µ—Ç node_modules - –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
cd /var/www/mapmon

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
yarn install

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
npm run build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å PM2
pm2 start ecosystem.config.cjs
```

## üéØ **–û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:**

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```bash
# –ü–æ—Ä—Ç—ã –¥–æ–ª–∂–Ω—ã —Å–ª—É—à–∞—Ç—å—Å—è
sudo netstat -tulpn | grep -E ":3000|:3001"
tcp 0.0.0.0:3000 LISTEN PM2
tcp 0.0.0.0:3001 LISTEN PM2

# API –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å
curl http://localhost:3001/api/status
{"status":"API Server running..."}

# Frontend –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å  
curl http://localhost:3000/
<!DOCTYPE html>...

# –¢–æ–≥–¥–∞ —á–µ—Ä–µ–∑ Nginx —Ç–æ–∂–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
curl http://fleetmonitor.ru/api/status
```

## üö® **–í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´ 502:**

1. **PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã —É–ø–∞–ª–∏** - —Å–∞–º–∞—è –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞
2. **–ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏**
3. **Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**
4. **–û—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ —Å–µ—Ä–≤–µ—Ä–æ–≤**
5. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∞–º—è—Ç–∏ –Ω–∞ VPS**

## üîß **–ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï:**

```bash
# –í—Å–µ –≤ –æ–¥–Ω–æ–º:
cd /var/www/mapmon && pm2 restart all && sleep 5 && pm2 status && curl http://localhost:3001/api/status
```

---

**üéØ –ì–õ–ê–í–ù–û–ï:** –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∏ —Å–ª—É—à–∞—é—Ç –ø–æ—Ä—Ç—ã 3000/3001!