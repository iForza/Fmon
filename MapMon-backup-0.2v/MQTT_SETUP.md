# üì° MQTT –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MapMon v0.3

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é MQTT –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ MapMon –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç ESP32 —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ EMQX Cloud

### –î–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
- **–°–µ—Ä–≤–µ—Ä:** `o0acf6a7.ala.dedicated.gcp.emqxcloud.com`
- **WebSocket –ø–æ—Ä—Ç:** `8084` (—Å TLS)
- **TCP –ø–æ—Ä—Ç:** `1883` (–±–µ–∑ TLS)
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `iforza`
- **Client ID:** `iforza`

### –¢–æ–ø–∏–∫–∏:
- `car` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–ø–∏–∫ –¥–ª—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
- `vehicles/+/telemetry` - —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
- `vehicles/+/status` - —Å—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É MQTT** –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
2. **–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ EMQX
3. **–ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"**
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å** - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å "–ü–æ–¥–∫–ª—é—á–µ–Ω" —Å –∑–µ–ª–µ–Ω—ã–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```
URL: wss://o0acf6a7.ala.dedicated.gcp.emqxcloud.com:8084/mqtt
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: iforza
Client ID: iforza
–¢–æ–ø–∏–∫–∏: car, vehicles/+/telemetry, vehicles/+/status
```

## üîå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ESP32

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
```cpp
#include <WiFi.h>
#include <PubSubClient.h>
#include <ArduinoJson.h>
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ Arduino IDE:
1. `PubSubClient` by Nick O'Leary
2. `ArduinoJson` by Benoit Blanchon

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```cpp
// WiFi –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
const char* ssid = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";

// EMQX Cloud –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
const char* mqtt_server = "o0acf6a7.ala.dedicated.gcp.emqxcloud.com";
const char* mqtt_username = "iforza";
const char* mqtt_password = "YOUR_MQTT_PASSWORD";
```

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è (—Ç–æ–ø–∏–∫: `car`):
```json
{
  "id": "ESP32_Car_2046",
  "lat": 55.7558,
  "lng": 37.6176,
  "speed": 25,
  "status": "active",
  "battery": 85.5,
  "temperature": 28.3,
  "rpm": 2100,
  "timestamp": 1234567890
}
```

### –°—Ç–∞—Ç—É—Å (—Ç–æ–ø–∏–∫: `vehicles/ESP32_Car_2046/status`):
```json
{
  "id": "ESP32_Car_2046",
  "status": "online",
  "timestamp": 1234567890
}
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ESP32:
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ `esp32/mqtt_test.ino`
2. –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_WIFI_SSID` –∏ `YOUR_WIFI_PASSWORD`
3. –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_MQTT_PASSWORD` –Ω–∞ –ø–∞—Ä–æ–ª—å EMQX
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ –Ω–∞ ESP32

### 2. –ó–∞–ø—É—Å–∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
yarn dev
```

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MQTT:
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3002
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É MQTT
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å EMQX
4. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –í–∫–ª—é—á–∏—Ç–µ ESP32
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Serial Monitor - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
3. –í –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–¢–µ—Å—Ç" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
- **–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å MQTT
- **–¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏ –ø–æ—Ä—Ç
- **–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–ø–∏–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç JSON

### –õ–æ–≥–∏:
- **ESP32:** Serial Monitor (115200 baud)
- **–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- **MQTT —Å–æ–æ–±—â–µ–Ω–∏—è:** –í–∫–ª–∞–¥–∫–∞ MQTT ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MQTT
- üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
- üìä –°–∫–æ—Ä–æ—Å—Ç—å, –±–∞—Ç–∞—Ä–µ—è, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, RPM
- üìù –ò—Å—Ç–æ—Ä–∏—è MQTT —Å–æ–æ–±—â–µ–Ω–∏–π
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
- üì° –¢–µ–ª–µ–º–µ—Ç—Ä–∏—é –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- üíì –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ

## üõ†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:
1. –ò–∑–º–µ–Ω–∏—Ç–µ `mqtt_client_id` –≤ –∫–æ–¥–µ ESP32
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
1. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è –≤ JSON —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
2. –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

**–í–µ—Ä—Å–∏—è:** 0.3v  
**–î–∞—Ç–∞:** 14.06.2025  
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è MQTT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 