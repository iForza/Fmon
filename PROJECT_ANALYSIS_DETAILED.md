# üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ï–ö–¢–ê MapMon v0.5

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï
1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º](#–∞–Ω–∞–ª–∏–∑-—Ñ–∞–π–ª–æ–≤)
3. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
4. [–õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#–ª–æ–≥–∏–∫–∞-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
5. [–õ–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã –∏ –∫–æ–¥](#–ª–∏—à–Ω–∏–µ-—Ñ–∞–π–ª—ã)
6. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
MapMon v0.5/
‚îú‚îÄ‚îÄ Frontend (Nuxt 3 + Vue 3)
‚îú‚îÄ‚îÄ Backend API (Fastify)
‚îú‚îÄ‚îÄ MQTT System (Dual Implementation)
‚îú‚îÄ‚îÄ ESP32 Firmware
‚îî‚îÄ‚îÄ Database (SQLite)
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
- **Frontend**: Nuxt 3.17.5, Vue 3.5.12, Tailwind CSS, @nuxt/ui
- **Charts**: ApexCharts 4.7.0, ECharts 5.5.0 (–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï!)
- **Maps**: MapLibre GL JS 5.6.0
- **Backend**: Fastify 5.4.0, Node.js
- **MQTT**: MQTT.js 5.13.1, PubSubClient (ESP32)
- **Database**: SQLite (better-sqlite3 11.10.0)

---

## üìÅ –ê–ù–ê–õ–ò–ó –§–ê–ô–õ–û–í –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú

### üéØ –û–°–ù–û–í–ù–´–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–û–ù–ù–´–ï –§–ê–ô–õ–´

#### ‚úÖ `package.json` - –•–û–†–û–®–û
**–°—Ç–∞—Ç—É—Å**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
**–ü—Ä–æ–±–ª–µ–º—ã**: 
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ –≥—Ä–∞—Ñ–∏–∫–æ–≤ (apexcharts + echarts)
- ‚ö†Ô∏è –í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞ 0.7.0, –Ω–æ –≤–µ–∑–¥–µ —É–∫–∞–∑–∞–Ω–æ 0.5v
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

#### ‚úÖ `nuxt.config.ts` - –•–û–†–û–®–û  
**–°—Ç–∞—Ç—É—Å**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: 
- –ú–æ–¥—É–ª–∏ @nuxt/ui, @nuxt/icon
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ü—Ä–æ–∫—Å–∏ –¥–ª—è API (/api -> localhost:3001)
**–ü—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Ç

#### ‚úÖ `ecosystem.config.cjs` - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´
**–°—Ç–∞—Ç—É—Å**: –°–æ–¥–µ—Ä–∂–∏—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–µ –æ—à–∏–±–∫–∏
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2**:
1. `mapmon` - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ—Ä—Ç 3000)
2. `mapmon-api` - API —Å–µ—Ä–≤–µ—Ä –∏–∑ backup
3. `mqtt-collector` - MQTT –∫–æ–ª–ª–µ–∫—Ç–æ—Ä

**‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´**:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–º–µ—Å—Ç–æ 1
- API –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è (server/index.ts + server-backup/api-server.cjs)
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ –∏ –ª–æ–≥–∏–∫–∏

### üé® FRONTEND –ö–û–ú–ü–û–ù–ï–ù–¢–´

#### ‚úÖ `app.vue` - –û–°–ù–û–í–ù–û–ô –ö–û–ú–ü–û–ù–ï–ù–¢
**–°—Ç–∞—Ç—É—Å**: –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç useApi() –≤–º–µ—Å—Ç–æ MQTT
- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —Ç–µ—Ö–Ω–∏–∫–æ–π (30%)
- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∫–∞—Ä—Ç–æ–π (70%)
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
**–õ–æ–≥–∏–∫–∞**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å MQTT –Ω–∞ API

#### ‚úÖ `components/MapComponent.vue` - –ö–ê–†–¢–´
**–°—Ç–∞—Ç—É—Å**: –û—Ç–ª–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- MapLibre GL JS —Å 5 —Å—Ç–∏–ª—è–º–∏ –∫–∞—Ä—Ç
- –°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ —Å–Ω–∏–º–∫–∏ ESRI
- –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Ö–Ω–∏–∫–∏ —Å popup
- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö

#### ‚ö†Ô∏è `components/ChartComponent.vue` - –ì–†–ê–§–ò–ö–ò
**–°—Ç–∞—Ç—É—Å**: –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- ECharts –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- 4 —Ç–∏–ø–∞: speed, temperature, battery, rpm
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞, zoom, tooltip
**‚ùå –ü–†–û–ë–õ–ï–ú–´**:
- –¶–≤–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –æ—Ä–∞–Ω–∂–µ–≤—ã–π (#F59E0B)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ECharts, –Ω–æ –≤ package.json –µ—Å—Ç—å —Ç–∞–∫–∂–µ ApexCharts
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ –≥—Ä–∞—Ñ–∏–∫–æ–≤

### üîß –ö–û–ú–ü–û–ó–ê–ë–õ–´ (COMPOSABLES)

#### ‚úÖ `composables/useApi.ts` - –û–°–ù–û–í–ù–û–ô API –ö–õ–ò–ï–ù–¢
**–°—Ç–∞—Ç—É—Å**: –•–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ó–∞–º–µ–Ω–∞ useMqtt.ts –Ω–∞ API –ø–æ–¥—Ö–æ–¥
- WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –†–∞–±–æ—Ç–∞ —Å SQLite —á–µ—Ä–µ–∑ API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π polling –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

**–ú–µ—Ç–æ–¥—ã**:
- `fetchVehicles()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ö–Ω–∏–∫–∏
- `fetchTelemetry()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏  
- `checkApiStatus()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API
- `connectWebSocket()` - WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

#### ‚ö†Ô∏è `composables/useMqttSettings.ts` - –ù–ê–°–¢–†–û–ô–ö–ò MQTT
**–°—Ç–∞—Ç—É—Å**: –£–°–¢–ê–†–ï–í–®–ò–ô/–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø
**–ü—Ä–æ–±–ª–µ–º—ã**:
- –ü—Ä–æ–µ–∫—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ API, –Ω–æ —Ñ–∞–π–ª –æ—Å—Ç–∞–ª—Å—è
- –°–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è test.mosquitto.org:8080
- –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –õ–ò–®–ù–ò–ô –§–ê–ô–õ

#### ‚úÖ `composables/useAdmin.ts` - –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
**–°—Ç–∞—Ç—É—Å**: –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ

### üìÑ –°–¢–†–ê–ù–ò–¶–´ (PAGES)

#### ‚úÖ `pages/index.vue` - –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê
**–°—Ç–∞—Ç—É—Å**: –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å —Ç–µ—Ö–Ω–∏–∫–æ–π

#### ‚úÖ `pages/analytics.vue` - –ê–ù–ê–õ–ò–¢–ò–ö–ê  
**–°—Ç–∞—Ç—É—Å**: –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: –ì—Ä–∞—Ñ–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### ‚ö†Ô∏è `pages/history.vue` - MQTT –û–¢–õ–ê–î–ß–ò–ö
**–°—Ç–∞—Ç—É—Å**: –°–û–î–ï–†–ñ–ò–¢ –û–®–ò–ë–ö–ò –ò –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: 2 –≤–∫–ª–∞–¥–∫–∏ - –ò—Å—Ç–æ—Ä–∏—è (–∑–∞–≥–ª—É—à–∫–∞) + MQTT –æ—Ç–ª–∞–¥–∫–∞

**‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´**:
1. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±—Ä–æ–∫–µ—Ä–æ–≤**:
   - –í–µ–±: `test.mosquitto.org:8081/mqtt` (WebSocket)
   - ESP32: `test.mosquitto.org:1883` (TCP)
   - –°–µ—Ä–≤–µ—Ä: `test.mosquitto.org:1883` (TCP)

2. **–¢–æ–ø–∏–∫–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç**:
   - ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `car`, `vehicles/ESP32_Car_2046/status`, `vehicles/ESP32_Car_2046/heartbeat`
   - –í–µ–± –ø–æ–¥–ø–∏—Å–∞–Ω: `car`, `vehicles/+/telemetry`, `vehicles/+/status`, `vehicles/+/heartbeat`

3. **–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã**:
   - ESP32: PubSubClient (TCP MQTT)
   - –ë—Ä–∞—É–∑–µ—Ä: MQTT.js (WebSocket MQTT)

### üñ•Ô∏è –°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨

#### ‚ö†Ô∏è `server/index.ts` - –û–°–ù–û–í–ù–û–ô –°–ï–†–í–ï–†
**–°—Ç–∞—Ç—É—Å**: –ò–ó–ë–´–¢–û–ß–ù–´–ô/–î–£–ë–õ–ò–†–û–í–ê–ù–ù–´–ô
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- Fastify —Å WebSocket, CORS
- API –º–∞—Ä—à—Ä—É—Ç—ã (/api/vehicles, /api/telemetry)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SQLiteManager
- –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ –Ω—É–∂–Ω—ã!)

**‚ùå –ü–†–û–ë–õ–ï–ú–´**:
- –î—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª server-backup/api-server.cjs
- –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ SQLite
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å ecosystem.config.cjs

#### ‚úÖ `server-backup/api-server.cjs` - –†–ï–ê–õ–¨–ù–´–ô API
**–°—Ç–∞—Ç—É—Å**: –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π —Å–µ—Ä–≤–µ—Ä
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- CORS, API endpoints
- –†–∞–±–æ—Ç–∞ —Å SQLite —á–µ—Ä–µ–∑ SQLiteManager
- –ü–æ–ª—É—á–µ–Ω–∏–µ vehicles, telemetry, history
- MQTT —Å—Ç–∞—Ç—É—Å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /api/vehicles` - —Å–ø–∏—Å–æ–∫ —Ç–µ—Ö–Ω–∏–∫–∏
- `GET /api/telemetry/latest` - –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
- `GET /api/telemetry/history` - –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- `GET /api/status` - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
- `POST /api/mqtt/config` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT
- `POST /api/mqtt/restart` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ MQTT

#### ‚úÖ `server-backup/mqtt-collector.cjs` - MQTT –ö–û–õ–õ–ï–ö–¢–û–†
**–°—Ç–∞—Ç—É—Å**: –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π –∫–æ–ª–ª–µ–∫—Ç–æ—Ä
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ test.mosquitto.org:1883 (TCP)
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫–∏ ESP32
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ SQLite —á–µ—Ä–µ–∑ SQLiteManager
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–¢–æ–ø–∏–∫–∏**:
- `car` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
- `vehicles/+/telemetry` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- `vehicles/+/status` - —Å—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `vehicles/+/heartbeat` - heartbeat

#### ‚úÖ `server-backup/SQLiteManager.cjs` - –ë–ê–ó–ê –î–ê–ù–ù–´–•
**–°—Ç–∞—Ç—É—Å**: –•–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: 
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü vehicles, telemetry
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏

### üîå ESP32 FIRMWARE

#### ‚úÖ `esp32/fleet_tracker/fleet_tracker.ino` - –û–°–ù–û–í–ù–û–ô –°–ö–ï–¢–ß
**–°—Ç–∞—Ç—É—Å**: –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –ø–æ–¥—Ä–æ–±–Ω–æ

#### ‚ùå `esp32/mqtt_live_test/mqtt_live_test.ino` - –¢–ï–°–¢–û–í–´–ô –°–ö–ï–¢–ß
**–°—Ç–∞—Ç—É—Å**: –°–û–î–ï–†–ñ–ò–¢ –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
- –ë—Ä–æ–∫–µ—Ä: `test.mosquitto.org:1883` (TCP)
- Device ID: `ESP32_Car_2046`
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫ –≤ `car`
- Heartbeat –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫ –≤ `vehicles/ESP32_Car_2046/heartbeat`
- –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ –≤ `vehicles/ESP32_Car_2046/status`

**‚ùå –ü–†–û–ë–õ–ï–ú–´**: 
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —Ç–æ–ø–∏–∫ `vehicles/+/telemetry`, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç –≤–µ–±-–æ—Ç–ª–∞–¥—á–∏–∫
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç TCP MQTT (port 1883), –∞ –≤–µ–± - WebSocket (port 8080/8081)
- WiFi credentials –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê MQTT
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ MQTT
- ESP32 ‚Üí TCP MQTT (port 1883)
- Web ‚Üí WebSocket MQTT (port 8081)
- Server ‚Üí TCP MQTT (port 1883)

**–†–µ—à–µ–Ω–∏–µ**: –í—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥:
- –õ–∏–±–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ ESP32 –Ω–∞ WebSocket MQTT
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MQTT-WebSocket –º–æ—Å—Ç
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É MQTT

### 2. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –°–ï–†–í–ï–†–û–í
**–ü—Ä–æ–±–ª–µ–º–∞**: 
- `server/index.ts` (543 —Å—Ç—Ä–æ–∫–∏)
- `server-backup/api-server.cjs` (232 —Å—Ç—Ä–æ–∫–∏)
- –û–±–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç API –º–∞—Ä—à—Ä—É—Ç—ã

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –æ–¥–∏–Ω –∏–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ server-backup/

### 3. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –ë–ò–ë–õ–ò–û–¢–ï–ö –ì–†–ê–§–ò–ö–û–í
**–ü—Ä–æ–±–ª–µ–º–∞**: 
- `apexcharts` + `vue3-apexcharts`
- `echarts`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ ECharts

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å ApexCharts –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 4. –ù–ï–ö–û–†–†–ï–ö–¢–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø PM2
**–ü—Ä–æ–±–ª–µ–º–∞**: ecosystem.config.cjs –∑–∞–ø—É—Å–∫–∞–µ—Ç 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ 2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:
- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Nuxt
- MQTT –∫–æ–ª–ª–µ–∫—Ç–æ—Ä + API

### 5. –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¢–û–ü–ò–ö–û–í MQTT
**–ü—Ä–æ–±–ª–µ–º–∞**:
- ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ `car`
- –í–µ–± –æ–∂–∏–¥–∞–µ—Ç `vehicles/+/telemetry`

---

## üîÑ –õ–û–ì–ò–ö–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
ESP32 ‚Üí TCP MQTT (test.mosquitto.org:1883) ‚Üí mqtt-collector.cjs ‚Üí SQLite ‚Üí api-server.cjs ‚Üí useApi.ts ‚Üí Vue Components
                                                                                            ‚Üì
Web MQTT Debug ‚Üí WebSocket MQTT (test.mosquitto.org:8081) ‚Üê [–ù–ï –°–í–Ø–ó–ê–ù–û –° ESP32]
```

### –ü—Ä–æ–±–ª–µ–º—ã –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
1. ESP32 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TCP MQTT
2. mqtt-collector.cjs –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TCP MQTT  
3. –í–µ–±-–æ—Ç–ª–∞–¥—á–∏–∫ —Å–ª—É—à–∞–µ—Ç WebSocket MQTT
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í–µ–± –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥—Ä—É–≥–∏—Ö WebSocket –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–µ ESP32

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:
```
ESP32 ‚Üí TCP MQTT ‚Üí mqtt-collector.cjs ‚Üí SQLite ‚Üí api-server.cjs ‚Üí WebSocket/SSE ‚Üí Web Dashboard
```

---

## üóëÔ∏è –õ–ò–®–ù–ò–ï –§–ê–ô–õ–´ –ò –ö–û–î

### –§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:
1. **`server/index.ts`** - –¥—É–±–ª–∏—Ä—É–µ—Ç server-backup/api-server.cjs
2. **`composables/useMqttSettings.ts`** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ API
3. **ApexCharts –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –≤ package.json
4. **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤ server/index.ts

### –ò–∑–±—ã—Ç–æ—á–Ω—ã–π –∫–æ–¥:
1. **–î–µ–º–æ –¥–∞–Ω–Ω—ã–µ** –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (—É–∂–µ —É–¥–∞–ª–µ–Ω—ã)
2. **–î–≤–æ–π–Ω—ã–µ API endpoints** –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
3. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–∑–∞–±–ª—ã**

### –§–∞–π–ª—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
1. **`pages/history.vue`** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å MQTT –±—Ä–æ–∫–µ—Ä –∏ —Ç–æ–ø–∏–∫–∏
2. **`ecosystem.config.cjs`** - —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É PM2
3. **`esp32/mqtt_live_test/`** - –ø—Ä–∏–≤–µ—Å—Ç–∏ —Ç–æ–ø–∏–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

#### –ò—Å–ø—Ä–∞–≤–∏—Ç—å MQTT –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
```javascript
// –í pages/history.vue –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebSocket MQTT:
const MQTT_BROKER = 'ws://test.mosquitto.org:8080' // WebSocket –ø–æ—Ä—Ç (–ë–ï–ó /mqtt!)

// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç MQTT.js –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞:
import mqtt from 'mqtt'
const client = mqtt.connect(MQTT_BROKER, {
  protocol: 'ws',
  connectTimeout: 10000,
  reconnectPeriod: 5000
})

// –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π WebSocket broadcast –∏–∑ mqtt-collector.cjs
```

#### –£–ø—Ä–æ—Å—Ç–∏—Ç—å ecosystem.config.cjs:
```javascript
module.exports = {
  apps: [
    {
      name: 'mapmon',
      script: '.output/server/index.mjs', // –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    },
    {
      name: 'mapmon-backend', 
      script: 'server-backup/api-server.cjs', // API + MQTT –∫–æ–ª–ª–µ–∫—Ç–æ—Ä
    }
  ]
}
```

#### –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –£–¥–∞–ª–∏—Ç—å `server/index.ts`
- –£–¥–∞–ª–∏—Ç—å ApexCharts –∏–∑ package.json
- –£–¥–∞–ª–∏—Ç—å `composables/useMqttSettings.ts`

### 2. –°–¢–†–£–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

#### –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å MQTT:
```javascript
// –û–±—ä–µ–¥–∏–Ω–∏—Ç—å mqtt-collector.cjs –∏ api-server.cjs –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å
// –î–æ–±–∞–≤–∏—Ç—å WebSocket broadcast –¥–ª—è real-time –¥–∞–Ω–Ω—ã—Ö
```

#### –ò—Å–ø—Ä–∞–≤–∏—Ç—å ESP32 —Å–∫–µ—Ç—á –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```cpp
// –í esp32/mqtt_live_test/mqtt_live_test.ino –¥–æ–±–∞–≤–∏—Ç—å:

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–æ–ø–∏–∫
String telemetryTopic = "vehicles/" + String(device_id) + "/telemetry";
client.publish(telemetryTopic.c_str(), payload.c_str());

// –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–ø–∏–∫ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
client.publish("car", payload.c_str());

// –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Ñ–∞–π–ª/EEPROM –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞ WiFi
// –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É WebSocket MQTT –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–µ–±
```

### 3. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)

#### –£–ª—É—á—à–∏—Ç—å real-time:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Server-Sent Events –≤–º–µ—Å—Ç–æ polling
- –î–æ–±–∞–≤–∏—Ç—å WebSocket broadcast –∏–∑ mqtt-collector.cjs

#### –£–ø—Ä–æ—Å—Ç–∏—Ç—å dependency management:
- –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã
- –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏–∏ –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö

### 4. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–µ—Ä–≤–µ—Ä–Ω—ã–π MQTT (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
```
ESP32 ‚Üí TCP MQTT ‚Üí Node.js Collector ‚Üí SQLite ‚Üí API ‚Üí WebSocket ‚Üí Web
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–æ—Å—Ç MQTT
```
ESP32 ‚Üí TCP MQTT ‚Üí MQTT Bridge ‚Üí WebSocket MQTT ‚Üí Web
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: ESP32 WebSocket
```
ESP32 ‚Üí WebSocket MQTT ‚Üê Web (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ï–ö–¢–ê

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤:
- **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: ~2000 —Å—Ç—Ä–æ–∫
- **–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å**: ~1000 —Å—Ç—Ä–æ–∫  
- **ESP32 –∫–æ–¥**: ~400 —Å—Ç—Ä–æ–∫
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: ~100 —Å—Ç—Ä–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:
- üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ**: 5 –ø—Ä–æ–±–ª–µ–º
- üü° **–°—Ä–µ–¥–Ω–∏–µ**: 8 –ø—Ä–æ–±–ª–µ–º
- üü¢ **–ú–µ–ª–∫–∏–µ**: 12 –ø—Ä–æ–±–ª–µ–º

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É: **60%**
**–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–µ—Ä—ã**: MQTT –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: $(date)  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: MapMon v0.5  
**–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω**: Claude 3.5 Sonnet —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Context7 